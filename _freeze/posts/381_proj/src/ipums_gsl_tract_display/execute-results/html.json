{
  "hash": "b36b8155a2cfa294640fa16c469b5c34",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"GSL data display\"\nauthor: \"Harrison DeFord\"\ndate: '2022-11-18'\noutput: html_document\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2) \nlibrary(gganimate) \nlibrary(stringr) \nlibrary(ggpubr)\n```\n:::\n\n\n\n\nThis document handles the charts used in the original presentation. First, it reads data created in the previous script:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars_joined <- readr::read_csv(\"../data/vars_joined.csv\") \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 34 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (5): year, tpop, area, area_km, tpop_mn\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nvars_joined.playa <- vars_joined %>% \n  mutate(new_playa = lag(area_km)-area_km)\n```\n:::\n\n\n\n\nIt creates some labels, in a very inefficient manner -- if I were to rewrite this code today, I'd use something like `format(x, big.mark = \",\")`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars_joined.label <- vars_joined.playa %>%\n  mutate(tpop_lab = paste0(\"Total population: \", str_sub(tpop, 1,1), \",\", str_sub(tpop, 2,4), \",\", str_sub(tpop, 5,7)), \n         area_lab = paste0(\"Water area: \", str_sub(round(area_km), 1,1), \",\", str_sub(round(area_km), 2,4), \" sq. km\"), \n         playa_lab = paste0(\"New playa area: \", round(new_playa), \" sq. km\"))\n```\n:::\n\n\n\n\nFirst, we set up an empty set of axes on which we'll plot our data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(data = vars_joined, aes(x = year, y = tpop_mn))+ \n  labs(title = \"Population of counties bordering the Great Salt Lake, Utah, 1986-2021\",\n       x = \"Year\", y = \"Population (millions)\")+\n  theme(panel.background = element_blank(),\n        axis.title.x = element_text(size = 16), \n        axis.title.y = element_text(size = 16, hjust = 0.4, vjust = 1), \n        axis.text.x = element_text(color = \"black\", size = 14), \n        axis.text.y = element_text(color = \"black\", size = 14), \n        plot.title = element_text(hjust = 0, vjust = 5, size = 18, face = \"bold\"), \n        legend.key = element_blank(), \n        legend.position = \"top\", \n        plot.margin = margin(1, 5, 0.1,0.1, 'cm')) \n\np1\n```\n\n::: {.cell-output-display}\n![](ipums_gsl_tract_display_files/figure-html/unnamed-chunk-4-1.png){width=3000}\n:::\n:::\n\n\n\n\nThen, we'll use those axes to create an animated chart showing change in population over time.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- p1 + \n  geom_point(data = vars_joined.label, aes(x = year, y = tpop_mn), color = \"#ffb303\", size = 3)+ \n  geom_line(data = vars_joined.label, aes(x = year, y = tpop_mn), color = \"#ffb303\", size = 1)+ \n  geom_text(data = vars_joined.label, aes(x = year + .1, y = tpop_mn), \n            label = vars_joined.label$tpop_lab, \n            hjust = -0.1, \n            vjust = -1, \n            size = 4, \n            show.legend = FALSE)+\n  transition_reveal(year)+ \n  ease_aes('linear')+ \n  coord_cartesian(clip = 'off') \n\nanimate(p2, start_pause = 24, end_pause = 24)\n```\n:::\n\n\n\n\n![](../images/utah_slc_pop.gif)\n\nJust like before, we'll create an empty set of axes, this time for water area:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- ggplot(data = vars_joined, aes(x = year, y = area_km))+\n  labs(title = \"Water area of the Great Salt Lake, 1986-2021\", x = \"Year\", y = \"Water area,\"~km^2)+\n  theme(panel.background = element_blank(), \n        axis.title.x = element_text(size = 16), \n        axis.title.y = element_text(size = 16, hjust = 0.4, vjust = 1), \n        axis.text.x = element_text(color = \"black\", size = 14), \n        axis.text.y = element_text(color = \"black\", size = 14), \n        plot.title = element_text(hjust = 0, vjust = 5, size = 18, face = \"bold\"), \n        legend.key = element_blank(), \n        legend.position = \"top\", \n        plot.margin = margin(1, 5, 0.1,0.1, 'cm')) \n\np3\n```\n\n::: {.cell-output-display}\n![](ipums_gsl_tract_display_files/figure-html/unnamed-chunk-6-1.png){width=3000}\n:::\n:::\n\n\n\n\nAnd, again like before, we'll animate over those axes.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4 <- p3 + \n  geom_point(data = vars_joined, aes(x = year, y = area_km), color = \"#03afff\", size = 3)+ \n  geom_line(data = vars_joined, aes(x = year, y = area_km), color = \"#03afff\", size = 1)+ \n  geom_text(data = vars_joined.label, aes(x = year + .1, y = area_km), \n            label = vars_joined.label$area_lab, \n            hjust = -0.1, \n            vjust = -1, \n            size = 4, \n            show.legend = FALSE)+\n  transition_reveal(year)+\n  ease_aes('linear')+\n  transition_reveal(year)+\n  coord_cartesian(clip = 'off')\n\nanimate(p4, start_pause = 24, end_pause = 24)\n\nif (!file.exists(\"../images/utah_gsl_area.gif\")){\n  anim_save(filename = \"../images/utah_gsl_area.gif\", \n            fps = 24, nframes = 207, \n            animation = p4, \n            start_pause = 24, \n            end_pause = 24, \n            height = 1080, \n            width = 1920, \n            res = 180, \n            renderer = gifski_renderer())\n}\n```\n:::\n\n\n\n\n![](../images/utah_gsl_area.gif)\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\nOne last time, this time creating a linear regression model:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np8 <- ggplot(data = vars_joined.label, aes(x = tpop, y = area_km))+ \n  labs(title = \"Water area of the Great Salt Lake compared with population, 1986-2021\", x = \"Population of counties bordering the Great Salt Lake\", y = \"Water area,\"~km^2)+ \n  theme(panel.background = element_blank(), \n        axis.title.x = element_text(size = 16), \n        axis.title.y = element_text(size = 16, hjust = 0.5, vjust = 1), \n        axis.text.x = element_text(color = \"black\", size = 14), \n        axis.text.y = element_text(color = \"black\", size = 14), \n        plot.title = element_text(hjust = 0, vjust = 5, size = 18, face = \"bold\"), \n        legend.key = element_blank(), \n        legend.position = \"top\", \n        plot.margin = margin(1, 0.1, 0.1,0.1, 'cm')) \n\np8\n```\n\n::: {.cell-output-display}\n![](ipums_gsl_tract_display_files/figure-html/unnamed-chunk-10-1.png){width=3300}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np7 <- p8+ geom_point(data = vars_joined, aes(x = tpop, y = area_km), color = \"black\", size = 2)+ \n  geom_smooth(method=lm, se = FALSE, color = \"#a82727\")+ \n  stat_regline_equation(label.x = 2300000, label.y = 6500, aes(label = ..eq.label..))+ \n  stat_regline_equation(label.x = 2400000, label.y = 6400, aes(label = ..rr.label..)) \n\np7\n\nif (!file.exists(\"../images/pop_vs_area.png\")){\n  ggsave(p7, filename = \"../images/pop_vs_area.png\", width = 1920, height = 1080, dpi = 180, units = 'px')\n}\n```\n:::\n\n\n\n\n![](../images/pop_vs_area.png)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinreg <- lm(area_km ~ tpop, data = vars_joined)\n\nsummary(linreg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = area_km ~ tpop, data = vars_joined)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-719.1 -243.1  -26.2  262.2  494.2 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  7.879e+03  2.847e+02   27.67  < 2e-16 ***\ntpop        -1.601e-03  1.489e-04  -10.75 3.73e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 322.5 on 32 degrees of freedom\nMultiple R-squared:  0.7832,\tAdjusted R-squared:  0.7764 \nF-statistic: 115.6 on 1 and 32 DF,  p-value: 3.731e-12\n```\n\n\n:::\n:::\n",
    "supporting": [
      "ipums_gsl_tract_display_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}